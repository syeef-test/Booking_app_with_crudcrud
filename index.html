<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <form onsubmit="saveTolocalstorage(event)">
        <label for="username">Username</label>
        <input type="text" name="username" id="username" required>
        <label for="email">Email</label>
        <input type="email" name="email" id="email" required>
        <label for="phone">Phone</label>
        <input type="text" name="phone" id="phone">
        <input class="btn" type="submit" value="Submit">
    </form>
    <ul id="users"></ul>
</body>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>


    // window.onload = function() {
    //     //network call to fetch data from crudcrud on page load method 1
    // axios.get('https://crudcrud.com/api/19ad2f3c04ce434ba4e067b7407f07f5/appoinmentData')
    //             .then((response)=>{
    //                 data = response.data;
    //                 data.forEach(element => {
    //                     showUserOnScreen(element)
    //                 });
    //                 //showUserOnScreen(response.data);
    //                 console.log(response);
    //             }).
    //             catch((err)=>{
    //                 console.log(err);
    //             });
    // };

   function saveTolocalstorage(event){
    event.preventDefault();
    const name = event.target.username.value;
    // console.log(name);
    const email = event.target.email.value;
    const phone = event.target.phone.value;
    // localStorage.setItem('name',name);
    // localStorage.setItem('email',email);
    // localStorage.setItem('phone',phone);

    const obj = {
        name,
        email,
        phone
    }

    //network call
    axios.post('https://crudcrud.com/api/19ad2f3c04ce434ba4e067b7407f07f5/appoinmentData',obj)
                .then((response)=>{
                    showUserOnScreen(response.data);
                    console.log(response);
                }).
                catch((err)=>{
                    console.log(err);
                });

    //localStorage.setItem(obj.email,JSON.stringify(obj));
    //showUserOnScreen(obj);
    }

    window.addEventListener("DOMContentLoaded",()=>{
            //network call to fetch data from crudcrud on page load method2
            axios.get('https://crudcrud.com/api/19ad2f3c04ce434ba4e067b7407f07f5/appoinmentData')
                        .then((response)=>{
                            data = response.data;
                            data.forEach(element => {
                                showUserOnScreen(element)
                            });
                            //showUserOnScreen(response.data);
                            console.log(response);
                        }).
                        catch((err)=>{
                            console.log(err);
                        });
    });

   

    function showUserOnScreen(obj){
        const parentElem = document.getElementById('users');
        //const childElem = document.createElement('li');
        const childElem = `<li id=${obj._id}>${obj.name}-${obj.email}<button onclick=deleteUser('${obj._id}')>Delete</button><button onclick=editUserDetails('${obj._id},${obj.email},${obj.name},${obj.phone}')>Edit</button></li>`;

        parentElem.innerHTML = parentElem.innerHTML + childElem;

       

    }

    function deleteUserFromScreen(userId){
                const parentElem = document.getElementById('users');
                const childElem = document.getElementById(userId);
                parentElem.removeChild(childElem);//element removed from parent element
    }


    

    function deleteUser(userId){
        console.log(userId);
        axios
            .delete(`https://crudcrud.com/api/19ad2f3c04ce434ba4e067b7407f07f5/appoinmentData/${userId}`)
            .then(res=>{
                console.log(res);
                deleteUserFromScreen(userId);
            })
            .catch(err=>console.log(err));
    }


    function editUserDetails(userId,emailId,name,phone){
        console.log(userId,emailId,name,phone);
        
        
         document.getElementById('username').value = name;
         document.getElementById('email').value = emailId;
         document.getElementById('phone').value = phone;

        deleteUser(userId);

        
    }

    // function editUserDetails(emailId,name,phone,userId){
    //     axios
    //     .patch('https://crudcrud.com/api/19ad2f3c04ce434ba4e067b7407f07f5/appoinmentData/'+userId,{
    //         name:name,
    //         email:emailId,
    //         phone:phone
    //     })
    //     .then(res=>console.log(res))
    //     .catch(err=>console.log(err));

      
    // }
</script>
</html>