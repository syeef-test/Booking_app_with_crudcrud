<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <form onsubmit="saveTolocalstorage(event)">
        <label for="username">Username</label>
        <input type="text" name="username" id="username" required>
        <label for="email">Email</label>
        <input type="email" name="email" id="email" required>
        <label for="phone">Phone</label>
        <input type="text" name="phone" id="phone">
        <input class="btn" type="submit" value="Submit">
    </form>
    <ul id="users"></ul>
</body>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>


    // window.onload = function() {
    //     //network call to fetch data from crudcrud on page load method 1
    // axios.get('https://crudcrud.com/api/19ad2f3c04ce434ba4e067b7407f07f5/appoinmentData')
    //             .then((response)=>{
    //                 data = response.data;
    //                 data.forEach(element => {
    //                     showUserOnScreen(element)
    //                 });
    //                 //showUserOnScreen(response.data);
    //                 console.log(response);
    //             }).
    //             catch((err)=>{
    //                 console.log(err);
    //             });
    // };

   function saveTolocalstorage(event){
    event.preventDefault();
    const name = event.target.username.value;
    // console.log(name);
    const email = event.target.email.value;
    const phone = event.target.phone.value;
    // localStorage.setItem('name',name);
    // localStorage.setItem('email',email);
    // localStorage.setItem('phone',phone);

    const obj = {
        name,
        email,
        phone
    }

    //network call
    axios.post('https://crudcrud.com/api/19ad2f3c04ce434ba4e067b7407f07f5/appoinmentData',obj)
                .then((response)=>{
                    showUserOnScreen(response.data);
                    console.log(response);
                }).
                catch((err)=>{
                    console.log(err);
                });

    //localStorage.setItem(obj.email,JSON.stringify(obj));
    //showUserOnScreen(obj);
    }

    window.addEventListener("DOMContentLoaded",()=>{
            //network call to fetch data from crudcrud on page load method2
            axios.get('https://crudcrud.com/api/19ad2f3c04ce434ba4e067b7407f07f5/appoinmentData')
                        .then((response)=>{
                            data = response.data;
                            data.forEach(element => {
                                showUserOnScreen(element)
                            });
                            //showUserOnScreen(response.data);
                            console.log(response);
                        }).
                        catch((err)=>{
                            console.log(err);
                        });
    });

    function showUserOnScreen(obj){
        const parentElem = document.getElementById('users');
        const childElem = document.createElement('li');

        const id = obj._id;
        //console.log(obj.name,id);
        childElem.textContent = obj.name + '-' + obj.email + '-' + obj.phone;

        const deleteButton = document.createElement('input');
        deleteButton.type = 'button';
        deleteButton.value = 'Delete';
        deleteButton.onclick = () =>{

            axios
            .delete('https://crudcrud.com/api/19ad2f3c04ce434ba4e067b7407f07f5/appoinmentData/'+id)
            .then(res=>console(res))
            .catch(err=>console.log(err));//delete success but need to display data again
            //localStorage.removeItem(obj.email);
            //parentElem.removeChild(childElem);
        }

        const editButton = document.createElement('input');
        editButton.type = "button";
        editButton.value = "Edit";
        editButton.onclick = () =>{
            localStorage.removeItem(obj.email);
            parentElem.removeChild(childElem);
            document.getElementById('username').value = obj.name;
            document.getElementById('email').value = obj.email;
            document.getElementById('phone').value = obj.phone;

        }



        childElem.appendChild(deleteButton);
        childElem.appendChild(editButton);
        parentElem.appendChild(childElem);
    }
</script>
</html>